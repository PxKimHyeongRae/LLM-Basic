"""
온도 비교 전광판 메시지 학습 데이터 생성
yesterday_temp, today_temp만 입력받는 순수 온도 비교 데이터셋
"""

import json
import random
from pathlib import Path


def create_temperature_dataset():
    """
    LLM이 직접 작성한 자연스러운 온도 비교 메시지
    다양한 온도 조합에 대해 공원 특화 메시지 생성
    """

    dataset = []

    # ==================== 큰 온도 상승 (10도 이상) ====================

    # 추움 → 쌀쌀함
    dataset.extend([
        (-5, 8, "어제보다 13도 올라 포근해졌습니다. 공원 산책하기 좋아요."),
        (-10, 5, "어제보다 15도 상승했습니다. 따뜻하게 입고 공원 나오세요."),
        (0, 12, "어제보다 12도 올라 훨씬 포근합니다. 공원 산책로를 걸어보세요."),
        (-3, 10, "어제보다 13도 상승해 활동하기 좋습니다. 공원 조깅 추천합니다."),
    ])

    # 쌀쌀함 → 따뜻함
    dataset.extend([
        (5, 18, "어제보다 13도 올라 따뜻해졌습니다. 공원 산책 완벽한 날이에요."),
        (8, 22, "어제보다 14도 상승해 포근합니다. 공원 벤치에서 휴식하세요."),
        (10, 23, "어제보다 13도 올라 봄 날씨입니다. 공원 나들이 즐기세요."),
        (7, 20, "어제보다 13도 상승한 따뜻한 날입니다. 산책로를 걸어보세요."),
        (12, 25, "어제보다 13도 올라 화창합니다. 야외 활동 즐기기 좋아요."),
    ])

    # 따뜻함 → 더움
    dataset.extend([
        (20, 33, "어제보다 13도 올라 더워졌습니다. 공원 그늘에서 휴식하세요."),
        (22, 35, "어제보다 13도 상승해 무더워요. 공원 분수대 근처가 시원합니다."),
        (18, 30, "어제보다 12도 올라 많이 덥습니다. 오전 산책을 권장합니다."),
        (25, 38, "어제보다 13도 급상승했습니다. 공원 방문 시 수분 충분히 섭취하세요."),
    ])

    # 추움 → 따뜻함 (매우 큰 변화)
    dataset.extend([
        (-5, 18, "어제보다 23도나 올라 따뜻해졌습니다. 공원 산책 최고예요."),
        (0, 20, "어제보다 20도 급상승한 봄 날씨입니다. 공원 곳곳을 걸어보세요."),
        (5, 25, "어제보다 20도 올라 화창합니다. 가벼운 옷차림으로 산책하세요."),
        (-10, 12, "어제보다 22도 상승해 훨씬 포근합니다. 공원 나들이 추천합니다."),
    ])

    # ==================== 중간 온도 상승 (5-10도) ====================

    # 추움 → 쌀쌀함
    dataset.extend([
        (-5, 3, "어제보다 8도 올랐습니다. 공원 짧은 산책하기 좋아요."),
        (0, 7, "어제보다 7도 상승했습니다. 따뜻하게 입고 공원 나오세요."),
        (-2, 5, "어제보다 7도 올라 조금 포근해졌습니다. 공원을 걸어보세요."),
    ])

    # 쌀쌀함 → 쾌적함
    dataset.extend([
        (8, 15, "어제보다 7도 올라 쾌적합니다. 공원 산책하기 완벽해요."),
        (10, 17, "어제보다 7도 상승해 활동하기 좋습니다. 공원 조깅 추천합니다."),
        (12, 20, "어제보다 8도 올라 따뜻해졌습니다. 공원 벤치에서 휴식하세요."),
        (7, 15, "어제보다 8도 상승한 좋은 날씨입니다. 산책로를 걸어보세요."),
        (5, 13, "어제보다 8도 올라 포근합니다. 야외 활동 즐기세요."),
    ])

    # 쾌적함 → 따뜻함
    dataset.extend([
        (15, 23, "어제보다 8도 올라 따뜻합니다. 공원 산책 최고의 날이에요."),
        (18, 25, "어제보다 7도 상승해 화창합니다. 공원 나들이 즐기세요."),
        (17, 25, "어제보다 8도 올라 포근한 날입니다. 산책로 추천합니다."),
        (16, 24, "어제보다 8도 상승했습니다. 공원에서 여유 즐기세요."),
    ])

    # 따뜻함 → 더움
    dataset.extend([
        (22, 30, "어제보다 8도 올라 더워졌습니다. 공원 그늘막을 이용하세요."),
        (25, 33, "어제보다 8도 상승해 무더워요. 오전 산책 권장합니다."),
        (20, 28, "어제보다 8도 올라 많이 덥습니다. 공원 분수 근처가 시원해요."),
    ])

    # ==================== 작은 온도 상승 (1-5도) ====================

    # 추움
    dataset.extend([
        (-5, -2, "어제보다 3도 올랐지만 여전히 춥습니다. 공원 방문 시 따뜻하게 입으세요."),
        (0, 3, "어제보다 3도 상승했습니다. 짧은 산책 추천합니다."),
        (-8, -4, "어제보다 4도 올랐지만 추운 날씨입니다. 공원 방문 시 방한하세요."),
    ])

    # 쌀쌀함
    dataset.extend([
        (8, 12, "어제보다 4도 올라 조금 포근해졌습니다. 공원 산책하세요."),
        (10, 14, "어제보다 4도 상승했습니다. 공원을 걸어보세요."),
        (7, 11, "어제보다 4도 올랐습니다. 산책하기 좋은 날씨예요."),
        (12, 15, "어제보다 3도 상승해 쾌적합니다. 공원 조깅 추천합니다."),
    ])

    # 쾌적함 → 따뜻함
    dataset.extend([
        (18, 22, "어제보다 4도 올라 따뜻해졌습니다. 공원 산책 좋아요."),
        (16, 20, "어제보다 4도 상승했습니다. 공원 나들이 즐기세요."),
        (17, 21, "어제보다 4도 올라 포근합니다. 산책로를 걸어보세요."),
        (15, 19, "어제보다 4도 상승한 좋은 날입니다. 공원에서 휴식하세요."),
        (19, 23, "어제보다 4도 올랐습니다. 야외 활동하기 완벽해요."),
    ])

    # 따뜻함 → 더움
    dataset.extend([
        (25, 29, "어제보다 4도 올라 더 덥습니다. 공원 그늘에서 쉬세요."),
        (27, 31, "어제보다 4도 상승해 무더워요. 수분 섭취 충분히 하세요."),
        (23, 27, "어제보다 4도 올라 덥습니다. 공원 분수대를 찾아보세요."),
        (28, 32, "어제보다 4도 상승했습니다. 오전 시간대 산책 추천합니다."),
    ])

    # ==================== 온도 변화 거의 없음 (±0-2도) ====================

    dataset.extend([
        (-5, -5, "어제와 비슷하게 춥습니다. 공원 방문 시 따뜻하게 입으세요."),
        (0, 1, "어제와 비슷한 추운 날씨입니다. 짧은 산책만 추천합니다."),
        (5, 6, "어제와 비슷하게 쌀쌀합니다. 공원 산책 시 겉옷 챙기세요."),
        (10, 11, "어제와 동일한 날씨입니다. 공원을 걸어보세요."),
        (15, 15, "어제와 비슷한 쾌적한 날입니다. 공원 산책 좋아요."),
        (18, 19, "어제와 같은 날씨입니다. 공원 나들이 즐기세요."),
        (20, 20, "어제와 비슷합니다. 공원에서 여유를 즐기세요."),
        (23, 24, "어제와 동일한 화창한 날입니다. 산책로 추천합니다."),
        (25, 26, "어제와 비슷하게 따뜻합니다. 공원 벤치에서 휴식하세요."),
        (28, 28, "어제와 같은 더운 날씨입니다. 공원 그늘을 이용하세요."),
        (32, 33, "어제와 비슷하게 무덥습니다. 공원 분수 근처가 시원해요."),
    ])

    # ==================== 작은 온도 하강 (1-5도) ====================

    # 더움 → 따뜻함
    dataset.extend([
        (32, 28, "어제보다 4도 낮아져 조금 시원해졌습니다. 공원 산책하기 좋아요."),
        (30, 26, "어제보다 4도 하강했습니다. 야외 활동하기 좋은 날씨예요."),
        (28, 24, "어제보다 4도 내려가 쾌적해졌습니다. 공원 조깅 추천합니다."),
        (35, 31, "어제보다 4도 낮아졌지만 여전히 덥습니다. 공원 그늘 이용하세요."),
    ])

    # 따뜻함 → 쾌적함
    dataset.extend([
        (25, 21, "어제보다 4도 낮아져 선선해졌습니다. 공원 산책 완벽해요."),
        (23, 19, "어제보다 4도 하강해 쾌적합니다. 공원을 걸어보세요."),
        (22, 18, "어제보다 4도 내려갔습니다. 산책하기 좋은 날씨예요."),
        (27, 23, "어제보다 4도 낮아져 활동하기 좋습니다. 공원 나들이 즐기세요."),
        (20, 16, "어제보다 4도 하강했습니다. 가벼운 겉옷 챙기세요."),
    ])

    # 쾌적함 → 쌀쌀함
    dataset.extend([
        (18, 14, "어제보다 4도 낮아졌습니다. 공원 방문 시 긴팔 권장합니다."),
        (17, 13, "어제보다 4도 하강해 쌀쌀합니다. 겉옷 챙기세요."),
        (15, 11, "어제보다 4도 내려갔습니다. 따뜻하게 입고 산책하세요."),
    ])

    # 쌀쌀함 → 추움
    dataset.extend([
        (10, 6, "어제보다 4도 낮아져 춥습니다. 공원 방문 시 따뜻하게 입으세요."),
        (8, 4, "어제보다 4도 하강했습니다. 두꺼운 옷 필요해요."),
        (5, 1, "어제보다 4도 내려가 추워졌습니다. 짧은 산책만 추천합니다."),
    ])

    # ==================== 중간 온도 하강 (5-10도) ====================

    # 더움 → 따뜻함
    dataset.extend([
        (35, 27, "어제보다 8도 낮아져 시원해졌습니다. 공원 산책하기 좋아요."),
        (33, 25, "어제보다 8도 하강해 선선합니다. 야외 활동 즐기세요."),
        (30, 22, "어제보다 8도 내려가 쾌적해졌습니다. 공원 조깅 추천합니다."),
        (32, 25, "어제보다 7도 낮아졌습니다. 공원 나들이 완벽한 날이에요."),
    ])

    # 따뜻함 → 쌀쌀함
    dataset.extend([
        (25, 17, "어제보다 8도 낮아져 선선해졌습니다. 공원 산책 시 겉옷 챙기세요."),
        (23, 15, "어제보다 8도 하강했습니다. 긴팔 입고 공원 나오세요."),
        (28, 20, "어제보다 8도 내려갔습니다. 가벼운 겉옷 필요해요."),
        (22, 14, "어제보다 8도 낮아져 쌀쌀합니다. 따뜻하게 입고 산책하세요."),
    ])

    # 쾌적함 → 추움
    dataset.extend([
        (18, 10, "어제보다 8도 낮아졌습니다. 공원 방문 시 따뜻한 옷 챙기세요."),
        (15, 7, "어제보다 8도 하강해 추워졌습니다. 두꺼운 겉옷 필수예요."),
        (17, 9, "어제보다 8도 내려가 춥습니다. 짧은 산책 추천합니다."),
    ])

    # 쌀쌀함 → 매우 추움
    dataset.extend([
        (10, 2, "어제보다 8도 낮아져 많이 춥습니다. 공원 방문 시 방한하세요."),
        (8, 0, "어제보다 8도 하강했습니다. 따뜻하게 입고 짧게 산책하세요."),
        (5, -3, "어제보다 8도 내려가 매우 춥습니다. 공원 방문은 자제하세요."),
    ])

    # ==================== 큰 온도 하강 (10도 이상) ====================

    # 더움 → 쾌적함
    dataset.extend([
        (35, 20, "어제보다 15도 낮아져 시원해졌습니다. 공원 산책 완벽한 날이에요."),
        (33, 18, "어제보다 15도 급하강했습니다. 야외 활동하기 최고예요."),
        (38, 25, "어제보다 13도 내려가 쾌적해졌습니다. 공원 조깅 추천합니다."),
        (30, 17, "어제보다 13도 낮아졌습니다. 공원 나들이 즐기기 좋아요."),
    ])

    # 따뜻함 → 쌀쌀함
    dataset.extend([
        (25, 10, "어제보다 15도 낮아져 쌀쌀합니다. 공원 방문 시 겉옷 챙기세요."),
        (28, 13, "어제보다 15도 급하강했습니다. 따뜻하게 입고 산책하세요."),
        (23, 8, "어제보다 15도 내려갔습니다. 두꺼운 옷 필요해요."),
        (30, 15, "어제보다 15도 낮아져 선선합니다. 긴팔 입고 공원 나오세요."),
    ])

    # 따뜻함 → 추움
    dataset.extend([
        (20, 5, "어제보다 15도 낮아져 춥습니다. 공원 방문 시 따뜻하게 입으세요."),
        (18, 0, "어제보다 18도 급하강해 매우 춥습니다. 방한 준비 철저히 하세요."),
        (22, 2, "어제보다 20도 내려가 추워졌습니다. 짧은 산책만 추천합니다."),
    ])

    # 쾌적함 → 매우 추움
    dataset.extend([
        (15, -5, "어제보다 20도 급락했습니다. 공원 방문 시 두꺼운 옷 필수예요."),
        (18, -2, "어제보다 20도 내려가 매우 춥습니다. 공원 방문은 자제하세요."),
        (12, -8, "어제보다 20도 급하강해 극심한 추위입니다. 실내 활동 권장합니다."),
    ])

    return dataset


def create_structured_training_data():
    """구조화된 학습 데이터 생성"""

    # 기본 데이터셋
    base_dataset = create_temperature_dataset()

    # JSONL 형식으로 변환
    training_data = []

    for yesterday, today, message in base_dataset:
        prompt = f"""<instruction>
당신은 공원 전광판 메시지 전문가입니다. 주어진 온도 데이터를 간결한 한 문장으로 변환하세요.
</instruction>

<rules>
1. 반드시 한 문장만 출력하세요
2. 마크다운(**, ---, #), 특수문자, 이모지 사용 금지
3. 괄호나 설명 추가 금지
4. 질문 형식 금지
5. "출력:", "답:", "메시지:" 같은 레이블 없이 메시지만 작성
6. 40-70자 길이로 작성
7. 온도 차이를 구체적 숫자로 명시 (예: "5도", "10도")
</rules>

<task>
입력: 어제 {yesterday}도, 오늘 {today}도
출력:"""

        full_text = f"{prompt} {message}"

        training_data.append({
            "text": full_text,
            "input": f"어제 {yesterday}도, 오늘 {today}도",
            "output": message
        })

    return training_data


def main():
    print("=" * 70)
    print("순수 온도 비교 학습 데이터 생성")
    print("입력: yesterday_temp, today_temp만 사용")
    print("=" * 70)

    # 데이터 생성
    print("\n데이터 생성 중...")
    training_data = create_structured_training_data()

    print(f"✓ 총 {len(training_data)}개 데이터 생성 완료")

    # 셔플
    random.shuffle(training_data)

    # Train/Validation 분할 (90:10)
    split_idx = int(len(training_data) * 0.9)
    train_data = training_data[:split_idx]
    val_data = training_data[split_idx:]

    print(f"  - 학습 데이터: {len(train_data)}개")
    print(f"  - 검증 데이터: {len(val_data)}개")

    # 저장
    data_dir = Path("data")
    data_dir.mkdir(exist_ok=True)

    train_file = data_dir / "train_temperature.jsonl"
    val_file = data_dir / "validation_temperature.jsonl"

    print(f"\n파일 저장 중...")

    with open(train_file, 'w', encoding='utf-8') as f:
        for item in train_data:
            f.write(json.dumps({"text": item["text"]}, ensure_ascii=False) + '\n')

    with open(val_file, 'w', encoding='utf-8') as f:
        for item in val_data:
            f.write(json.dumps({"text": item["text"]}, ensure_ascii=False) + '\n')

    print(f"  ✓ 학습 데이터: {train_file}")
    print(f"  ✓ 검증 데이터: {val_file}")

    # 샘플 출력
    print("\n" + "=" * 70)
    print("생성된 데이터 샘플:")
    print("=" * 70)

    for i in range(5):
        print(f"\n[샘플 {i+1}]")
        print(f"입력: {train_data[i]['input']}")
        print(f"출력: {train_data[i]['output']}")

    print("\n" + "=" * 70)
    print("✅ 데이터 생성 완료!")
    print("=" * 70)
    print("\n다음 단계:")
    print("  python scripts/finetune_model_temperature.py")


if __name__ == "__main__":
    main()
