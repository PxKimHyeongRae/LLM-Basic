"""
파인튜닝을 위한 간결한 학습 데이터 생성
Inference 시 실제로 사용할 프롬프트 형식과 정확히 일치
"""

import json

# 간결한 프롬프트 템플릿 (레이블 없이)
TEMPLATE = """<instruction>
공원 전광판 메시지를 한 문장으로 작성하세요.
- 마크다운, 특수문자, 이모지 사용 금지
- 온도 차이를 구체적 숫자로 명시
- 40-70자 길이
- 공원 관련 조언 포함
</instruction>

어제 {yesterday}도, 오늘 {today}도
{message}"""

# 학습 데이터 (yesterday_temp, today_temp, message)
TRAIN_DATA = [
    # 큰 온도 상승 (10도 이상)
    (-5, 8, "어제보다 13도 올라 포근해졌습니다. 공원 산책하기 좋아요."),
    (-10, 5, "어제보다 15도 상승했습니다. 따뜻하게 입고 공원 나오세요."),
    (0, 12, "어제보다 12도 올라 훨씬 포근합니다. 공원 산책로를 걸어보세요."),
    (5, 18, "어제보다 13도 올라 따뜻해졌습니다. 공원 산책 완벽한 날이에요."),
    (8, 22, "어제보다 14도 상승해 포근합니다. 공원 벤치에서 휴식하세요."),
    (10, 23, "어제보다 13도 올라 봄 날씨입니다. 공원 나들이 즐기세요."),
    (12, 25, "어제보다 13도 올라 화창합니다. 야외 활동 즐기기 좋아요."),
    (20, 33, "어제보다 13도 올라 더워졌습니다. 공원 그늘에서 휴식하세요."),
    (22, 35, "어제보다 13도 상승해 무더워요. 공원 분수대 근처가 시원합니다."),
    (18, 30, "어제보다 12도 올라 많이 덥습니다. 오전 산책을 권장합니다."),

    # 중간 온도 상승 (5-9도)
    (3, 10, "어제보다 7도 올라 선선합니다. 공원 산책하기 좋아요."),
    (10, 17, "어제보다 7도 올라 쾌적합니다. 공원 벤치에서 쉬어가세요."),
    (15, 22, "어제보다 7도 올라 따뜻해졌습니다. 공원 산책 딱 좋아요."),
    (20, 27, "어제보다 7도 상승해 화창합니다. 공원에서 활동하기 좋아요."),
    (5, 11, "어제보다 6도 올라 선선해졌습니다. 공원 산책로를 걸어보세요."),

    # 작은 온도 상승 (1-4도)
    (10, 12, "어제보다 2도 올라 선선합니다. 공원 산책 좋아요."),
    (15, 18, "어제보다 3도 올라 쾌적합니다. 공원 벤치에서 쉬어가세요."),
    (20, 23, "어제보다 3도 올라 따뜻합니다. 공원 산책하기 좋아요."),
    (25, 28, "어제보다 3도 올라 화창합니다. 공원 나들이 즐기세요."),

    # 큰 온도 하강 (10도 이상)
    (35, 22, "어제보다 13도 낮아져 시원해졌습니다. 공원 산책하기 좋아요."),
    (30, 18, "어제보다 12도 낮아져 쾌적합니다. 공원에서 여유를 즐기세요."),
    (33, 20, "어제보다 13도 떨어져 선선해졌습니다. 공원 산책 최고예요."),
    (28, 15, "어제보다 13도 낮아져 시원합니다. 공원 산책로를 걸어보세요."),
    (25, 10, "어제보다 15도 떨어져 쌀쌀해졌습니다. 겉옷 챙기세요."),

    # 중간 온도 하강 (5-9도)
    (30, 24, "어제보다 6도 낮아져 쾌적합니다. 공원 산책하기 좋아요."),
    (25, 18, "어제보다 7도 떨어져 선선해졌습니다. 공원 벤치에서 쉬어가세요."),
    (28, 21, "어제보다 7도 낮아져 선선합니다. 공원 산책 딱 좋아요."),
    (20, 14, "어제보다 6도 떨어져 시원해졌습니다. 공원 산책로를 걸어보세요."),

    # 작은 온도 하강 (1-4도)
    (25, 22, "어제보다 3도 낮아져 따뜻합니다. 공원 산책하기 좋아요."),
    (20, 17, "어제보다 3도 떨어져 쾌적합니다. 공원 벤치에서 쉬어가세요."),
    (18, 15, "어제보다 3도 낮아져 선선합니다. 공원 산책로를 걸어보세요."),

    # 온도 동일
    (20, 20, "어제와 비슷합니다. 공원에서 여유를 즐기세요."),
    (15, 15, "어제와 같은 날씨입니다. 공원 산책하기 좋아요."),
    (25, 25, "기온이 비슷합니다. 공원 나들이 즐기세요."),

    # 극한 추위
    (-15, -5, "어제보다 10도 올라 조금 나아졌습니다. 방한 준비 철저히 하세요."),
    (-10, 0, "어제보다 10도 올라 영상이 되었습니다. 공원 방문해보세요."),

    # 극한 더위
    (30, 38, "어제보다 8도 올라 매우 덥습니다. 실내 활동 권장합니다."),
    (40, 30, "어제보다 10도 낮아져 조금 나아졌습니다. 여전히 덥습니다."),
]

VALIDATION_DATA = [
    (28, 22, "어제보다 6도 낮아져 선선해졌습니다. 공원 산책하기 좋아요."),
    (8, 15, "어제보다 7도 올라 따뜻해졌습니다. 공원에서 여유를 즐기세요."),
    (32, 33, "어제와 비슷한 날씨입니다. 공원 분수대 근처가 시원해요."),
    (18, 9, "어제보다 9도 낮아져 쌀쌀합니다. 공원 방문 시 겉옷 챙기세요."),
    (2, 12, "어제보다 10도 올라 포근해졌습니다. 공원 조깅하기 좋아요."),
]


def create_jsonl(data, output_file):
    """데이터를 JSONL 형식으로 저장"""
    with open(output_file, 'w', encoding='utf-8') as f:
        for yesterday, today, message in data:
            text = TEMPLATE.format(yesterday=yesterday, today=today, message=message)
            f.write(json.dumps({"text": text}, ensure_ascii=False) + '\n')


def main():
    print("=" * 70)
    print("간결한 학습 데이터 생성")
    print("=" * 70)

    # 학습 데이터 생성
    train_file = "data/train_simple.jsonl"
    create_jsonl(TRAIN_DATA, train_file)
    print(f"\n✅ 학습 데이터: {len(TRAIN_DATA)}개 → {train_file}")

    # 검증 데이터 생성
    val_file = "data/validation_simple.jsonl"
    create_jsonl(VALIDATION_DATA, val_file)
    print(f"✅ 검증 데이터: {len(VALIDATION_DATA)}개 → {val_file}")

    # 샘플 출력
    print("\n" + "=" * 70)
    print("생성될 프롬프트 형식:")
    print("=" * 70)
    yesterday, today, message = TRAIN_DATA[0]
    sample = TEMPLATE.format(yesterday=yesterday, today=today, message=message)
    print(sample)

    print("\n" + "=" * 70)
    print("Inference 시 사용할 프롬프트 (메시지 제외):")
    print("=" * 70)
    inference_prompt = TEMPLATE.format(yesterday=10, today=20, message="").rsplit('\n', 1)[0]
    print(inference_prompt)

    print("\n✅ 데이터 생성 완료!")
    print(f"   총 {len(TRAIN_DATA) + len(VALIDATION_DATA)}개의 데이터가 생성되었습니다.")


if __name__ == "__main__":
    main()
